(this["webpackJsonpgra-invoicer"]=this["webpackJsonpgra-invoicer"]||[]).push([[16],{660:function(e,t,a){"use strict";a.r(t);var n=a(20),c=a(26),s=a(8),r=a(2),i=a.n(r),l=a(179),o=a(56),u=a(165),d=a(244),j=a(110),b=a(80),f=a(171),O=a(450),v=a(394),h=a(145),m=a(446),p=a(447),x=a(237),g=a(144),N=a(451),S=a(452),y=a(453),w=a(454),R=a(223),C=a(59),P=a(173),k=a(21),D=a(120),I=a(38),T=a(174),A=a(181),F=a(47),E=a(1);t.default=function(){var e=Object(r.useState)(1),t=Object(s.a)(e,2),a=t[0],G=t[1],L=Object(r.useState)([]),B=Object(s.a)(L,2),U=B[0],z=B[1],J=Object(r.useState)(9),M=Object(s.a)(J,1)[0],V=Object(r.useState)({totalItems:10,pageNumber:1,pageSize:5,totalPages:10}),q=Object(s.a)(V,2),K=q[0],W=q[1],Y=Object(r.useState)({totalPayable:0,totalSalesVAT:0,totalNoSalesInvoices:0}),Q=Object(s.a)(Y,2),X=Q[0],Z=Q[1],$=Object(r.useState)(1),_=Object(s.a)($,2),ee=_[0],te=_[1],ae=Object(r.useRef)(),ne=Object(r.useState)(!1),ce=Object(s.a)(ne,2),se=ce[0],re=ce[1],ie=Object(r.useState)(""),le=Object(s.a)(ie,2),oe=le[0],ue=le[1],de=Object(P.a)(oe,500),je=Object(s.a)(de,1)[0],be=Object(r.useState)(""),fe=Object(s.a)(be,2),Oe=fe[0],ve=fe[1],he=Object(r.useState)(null),me=Object(s.a)(he,2),pe=me[0],xe=me[1],ge=Object(r.useState)({}),Ne=Object(s.a)(ge,2),Se=Ne[0],ye=Ne[1],we=Object(I.a)(),Re=Object(r.useState)(""),Ce=Object(s.a)(Re,2),Pe=Ce[0],ke=Ce[1],De=Object(r.useState)(""),Ie=Object(s.a)(De,2),Te=Ie[0],Ae=Ie[1],Fe=Object(r.useState)(!1),Ee=Object(s.a)(Fe,2),He=Ee[0],Ge=Ee[1],Le=Object(r.useState)(!1),Be=Object(s.a)(Le,2)[1],Ue=Object(F.a)().selectedBranch,ze=i.a.useMemo((function(){return[{Header:"Invoice #",accessor:"invoiceNo",className:" text-left ",width:190},{Header:"Refund #",accessor:"refundNo",className:" text-left ",width:190},{Header:"Refund Date",accessor:"date",className:" text-left ",Cell:function(e){var t=e.cell.value;return Object(E.jsx)(E.Fragment,{children:new Date(t).toLocaleDateString("en-GB")})},width:140},{Header:"Customer",accessor:"customerName",className:" text-left ",width:"auto"},{Header:"Type",accessor:"refundType",className:" text-left ",width:140},{Header:"Total Refund Amount",accessor:"totalAmount",className:" text-left ",Cell:function(e){var t=e.cell.value;return Object(E.jsx)(E.Fragment,{children:Object(E.jsx)("div",{style:{textAlign:"right",width:"10%"},children:Object(o.b)(t)})})},width:140},{Header:function(){return Object(E.jsx)("div",{align:"center",children:"View"})},disableSortBy:!0,className:" text-center table-action",accessor:"action",width:140,Cell:function(e){return Object(E.jsx)(u.a,{style:{padding:"2px 8px"},className:"badge-success",onClick:function(t){var a,n;Je(null===e||void 0===e||null===(a=e.row)||void 0===a||null===(n=a.original)||void 0===n?void 0:n.id)},title:"Preview",children:Object(E.jsx)(C.f,{})})}}]}),[]),Je=(new AbortController,function(){var e=Object(c.a)(Object(n.a)().mark((function e(t){var a,c,s,r,i,l;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ae(t),Ge(!0),a="",e.prev=3,e.next=6,we.post("/api/GenerateRefundReportAsync",t);case 6:(c=e.sent)&&(s=c.data,r="application/pdf",ke(a="data:application/pdf;base64,"+s),re(!0),Ge(!1),i=function(e){for(var t=e.substr("data:".concat(r,";base64,").length),a=atob(t),n=a.length,c=new Uint8Array(n);n--;)c[n]=a.charCodeAt(n);return new Blob([c],{type:r})},(l=document.createElement("a")).href=URL.createObjectURL(i(a)),l.download="Invoice Report"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),Be(!1),k.b.error("System failed to download invoice "),Ge(!1);case 15:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()),Me=Object(R.a)(je?"/api/GetRefundsSearch/".concat(je):"/api/GetRefunds/".concat(ee,"/").concat(a,"/").concat(M,"/").concat(null===Ue||void 0===Ue?void 0:Ue.code),"refunds",a,Number(ee),je,(function(e){var t,a,n,c;if(z((null===e||void 0===e||null===(t=e.invoices)||void 0===t?void 0:t.items)||[]),W(null===(a=e.invoices)||void 0===a?void 0:a.paging),Z((null===e||void 0===e?void 0:e.summaries)||[]),0===(null===e||void 0===e||null===(n=e.invoices)||void 0===n||null===(c=n.items)||void 0===c?void 0:c.length)){var s,r,i,l=je?"No invoice matched your search: "+je:"No Invoice Available For "+(null===ae||void 0===ae||null===(s=ae.current)||void 0===s||null===(r=s.options[null===ae||void 0===ae||null===(i=ae.current)||void 0===i?void 0:i.selectedIndex])||void 0===r?void 0:r.innerText);k.b.info(l),xe(l)}else xe(null)}),(function(e){var t;k.b.error((null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||"Error loading Refunds")}),{filterUrl:"/api/GetRefundsSearch/".concat(je),shouldTransform:!1}),Ve=(Me.data,Me.refetch),qe=(Me.isFetching,Me.isLoading),Ke=Object(D.a)("/api/GetRefundsById/".concat(Oe),"refund-detail",Oe,(function(e){ve(""),ye(e),re(!0),"SUCCESS"===e.signatureStatus?(ye(e),re(!0)):ye(e)}),(function(e){k.b.error((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.Message)||"Could not get Refund detail"),re(!1)}),{isEnabled:!1}),We=Ke.refetch,Ye=(Ke.data,Ke.isLoading);Ke.isFetching;return Object(r.useEffect)((function(){return 0===a&&(W({totalItems:10,pageNumber:1,pageSize:10,totalPages:5}),G(1)),Ve(),function(){}}),[ee,a]),Object(r.useEffect)((function(){return je.length>1&&Ve(),function(){}}),[je]),Object(r.useEffect)((function(){return Oe.length>0&&We(),function(){}}),[Oe]),Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(l.a,{dayOfWeekSelRef:ae,summary:X,period:ee,setPeriod:te,pageName:"Refunds"}),Object(E.jsx)(k.a,{}),Object(E.jsx)(d.a,{className:"mt--7",fluid:!0,children:Object(E.jsx)(j.a,{className:"mt-5",children:Object(E.jsx)(b.a,{className:"mb-5 mb-xl-0",xl:"12",children:Object(E.jsxs)(f.a,{className:"shadow",children:[Object(E.jsx)(O.a,{className:"border-0",children:Object(E.jsx)(j.a,{className:"align-items-center",children:Object(E.jsx)("div",{className:"col",children:Object(E.jsx)(v.a,{className:"navbar-search navbar-search-light form-inline ",onSubmit:function(e){},children:Object(E.jsxs)(h.a,{className:"mb-0",children:[" ",Object(E.jsxs)(m.a,{className:"input-group-alternative",children:[Object(E.jsx)(p.a,{addonType:"prepend",style:{marginTop:7},children:Object(E.jsx)(x.a,{children:Object(E.jsx)("i",{className:"fas fa-search"})})}),Object(E.jsx)(g.a,{placeholder:"Search by Invoice No, Refund No or Customer name",type:"text",value:oe,onChange:function(e){if((null===oe||void 0===oe?void 0:oe.length)>25)return ue((function(e){return e.substring(0,16)})),void xe("Your search query is too long");ue(e.target.value)},style:{width:400}}),Object(E.jsx)(p.a,{addonType:"append",children:Object(E.jsx)(x.a,{})})]})]})})})})}),Object(E.jsx)("div",{style:H.body,children:Object(E.jsx)(T.a,{isLoading:qe||Ye||He,columns:ze,data:U,sortKey:"date",setSelectedRow:function(){return null},getPrintPDF:function(){return null},pdfData:Pe,message:pe})}),Object(E.jsx)(N.a,{className:"py-1",children:!(qe||Ye||He)&&(null===U||void 0===U?void 0:U.length)>0&&Object(E.jsx)("nav",{"aria-label":"...",children:null!==K&&void 0!==K&&K.pageNumber?Object(E.jsxs)(S.a,{className:"pagination justify-content-center mb-0",listClassName:"justify-content-center mb-0",children:[Object(E.jsx)(y.a,{children:Object(E.jsxs)(w.a,{onClick:function(e){e.preventDefault(),K.pageNumber>1&&(a<1||G((function(e){return Number(e)-1})))},children:[Object(E.jsx)("i",{className:"fas fa-angle-left"}),Object(E.jsx)("span",{className:"sr-only",children:"Previous"})]})}),Object(E.jsx)(y.a,{children:Object(E.jsx)(w.a,{onClick:function(e){return G(1)},children:"1"})}),Object(E.jsx)(y.a,{className:"active",children:Object(E.jsx)(w.a,{onClick:function(e){return e.preventDefault()},children:K.pageNumber})}),Object(E.jsx)(y.a,{children:Object(E.jsx)(w.a,{onClick:function(e){return G(K.totalPages)},children:K.totalPages})}),Object(E.jsx)(y.a,{children:Object(E.jsxs)(w.a,{onClick:function(e){K.pageNumber<K.totalPages&&a!==K.totalPages&&G((function(e){return Number(e)+1}))},children:[Object(E.jsx)("i",{className:"fas fa-angle-right"}),Object(E.jsx)("span",{className:"sr-only",children:"Next"})]})})]}):null})})]})})})}),se&&Object(E.jsx)(A.a,{setShowReport:re,formData:Se,getPrintPDF:Je,pdfData:Pe,selectedInvoiceNo:Te})]})};var H={body:{marginTop:-10,overflow:"auto",cursor:"pointer"}}}}]);